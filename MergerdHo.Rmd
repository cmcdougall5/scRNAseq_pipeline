---
title: "Pituitary corticotroph gene expression analysis"
subtitle: "Ho et al scRNA seq dataset"
author: "Craig McDougall"
date: "October 2020"
#set figure widths
#output: html_document
#output: 
# html_document:
#    toc: true
output: pdf_document
#output: ioslides_presentation
---

##  Housekeeping

Perform housekeeping (clear data and cache)
``` {r clean}
#First clear the environment;
rm(list=ls())

#Then the cache
gc()
```

Now setup for rmarkup;

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This document details the analysis of the single RNA sequence data by [Ho et.al. 2020](https://link.springer.com/article/10.1007/s13238-020-00705-x). available from [the NCBI gene expression omnibus](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE146619).

## Step 1. Call Libraries & Set Directories

Before the main body of the pipeline is run, all of the required libraries are called and 

```{r Initialising required libraries, include =FALSE}

library(dplyr) 
library(Seurat)
library(patchwork)
library(sctransform)
library(ggplot2)
library(scales)
library(monocle3)
library(SeuratWrappers)
library(Matrix)
library(reticulate)
```

Set a seed so that clusters look the same each time code is run:
``` {r set seed}
set.seed(1234)
```

Set working directory.
``` {r Set Directories, include = FALSE}
#set the working directory to directory wish to read data from and save analysis results to
data.dir <- setwd(here::here())
```

## Step 2. Load and merge the data:

Following this Seurat workflow for merging two datasets:https://satijalab.org/seurat/v3.0/merge_vignette.html 

The raw count and gene data is read in from the 10X sequence data files in the Ho folder.
``` {r read data}
Ho.data.male <- Read10X("Ho Data/Ho male")
Ho.data.female <- Read10X("Ho Data/Ho female")
```

Create the Seurat objects
``` {r create Seurats}
Ho.data.male <- CreateSeuratObject(counts=Ho.data.male, project = "Male", min.cells = 3, min.features = 200) 
Ho.data.female <- CreateSeuratObject(counts=Ho.data.female, project = "Female", min.cells = 3, min.features = 200) 
```


Then combine the two datasets;
``` {r create temp seurat}
Ho.Seuratobj<- merge(Ho.data.male, y = Ho.data.female, add.cell.ids = c("male", "female"), project = "Ho Data")
```

How many male/female cells?
``` {r how many m f Cells}
table(Ho.Seuratobj$orig.ident)
```

\newpage
## Step 3. Quality control plots

Before processing the data, some quality control plots are made to assess the quality of the data and explore confounding factors such as assessing the number of reads that map to mitochondrial genome.

``` {r QC plots}
Ho.Seuratobj <- PercentageFeatureSet(Ho.Seuratobj, pattern = "^mt-", col.name = "percent.mt")
VlnPlot(Ho.Seuratobj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"),ncol = 3, pt.size=0,group.by="orig.ident")

#make the plots
plot1 <- FeatureScatter(Ho.Seuratobj, feature1 = "nCount_RNA", feature2 = "percent.mt",group.by="orig.ident")
plot2 <- FeatureScatter(Ho.Seuratobj, feature1 = "nCount_RNA", feature2 = "nFeature_RNA",group.by="orig.ident")
#then plot
plot1 + plot2
```

\newpage
## Step 4.  Transform the data

THe data must be;

* Normalised to ensure all genes carry equal weight going forward and prevent heavily expressing genes from being over represented.
* Regressed to remove confounding factors such as areas mapped to the mitochondrial genome.
* Assessed for variable genes. 

The [SCTransform](https://satijalab.org/seurat/v3.1/sctransform_vignette.html) function performs all of these actions and greatly simplifies the code, negating the use of four separate functions. 

``` {r transform data}
Ho.Seuratobj <- SCTransform(Ho.Seuratobj, vars.to.regress = "percent.mt")
```

\newpage
## Step 5. Dimensional reduction

The first step in dimensional reduction is to conduct principal component analysis (PCA) on the scaled data, using the variable features as the input. PCA transforms the from the table into new features known as principal components, which capture the information of the dataset in a new way.

``` {r Principal component analysis}
Ho.Seuratobj <- RunPCA(Ho.Seuratobj)
```

An elbow plot can be used to assess which principal components contain the majority of the information and identify which may be removed from the dataset, so reduce noise by removing PCS containing no information;

``` {r Plot Elbow, echo = FALSE,fig.height=3.5}
#Do we need to keep all PCs, or is majority of data captured by a certain point?
ElbowPlot(Ho.Seuratobj, ndims=30)

```


With the principal components identified, the dataset can be reduced (remove  noise). Uniform Manifold Approximation and Projection (UMAP) is an algorithm for dimensional reduction and is applied on the PCA components established in the first step.
``` {r UMAP}
Ho.Seuratobj <- RunUMAP(Ho.Seuratobj, dims=1:23,UMAP.method = "umap-learn", metric = "correlation")
```



\newpage
## Step 6. Clustering

First establish shared nearest neighbour (SNN) information for the data by calculating the overlap between each cell based on its k.parameters using the [FindNeighbours function](https://www.rdocumentation.org/packages/Seurat/versions/3.1.4/topics/FindNeighbors).

The clusters can then be identified based on the SNN using a [FindClusters function](https://www.rdocumentation.org/packages/Seurat/versions/3.1.4/topics/FindClusters). 

``` {r cluster cells}
Ho.Seuratobj <- FindNeighbors(Ho.Seuratobj, dims=1:23, verbose=FALSE)
Ho.Seuratobj <- FindClusters(Ho.Seuratobj, resolution = 3 , verbose=FALSE)

```

Please note, that eventually need to subcluster between males and females. Reading on Seurat github this is not recommended on integrated datasets (https://github.com/satijalab/seurat/issues/1883) rather should increase resolution until desired clusters are seen. THis is the reason for such high resolution as permits DE analysis later by sex.

Once the clusters have been established, they can be projected into two lower dimensional space using a [dimensional reduction plot](https://www.rdocumentation.org/packages/Seurat/versions/3.1.4/topics/DimPlot) for visualisation.

``` {r plot clusters}
DimPlot(Ho.Seuratobj,group.by="orig.ident", label=TRUE) + NoLegend()+ ggtitle("scRNA Sequence Data By sex")
 
DimPlot(Ho.Seuratobj, label=TRUE) + NoLegend()+ ggtitle("scRNAseq clustered")

```


\newpage Attribute cell type

How well do the clusters approximate cell type? It is difficult to make absolute claims when attributing cell types to empirical cluster data based purely on an *in silico* analysis. However we may approximate the cell type of each cluster based on known canonical expression markers ^[[Fletcher et.al 2019](https://www.frontiersin.org/articles/10.3389/fendo.2019.00623/full)]^ ^[[Chung et.al 2018](https://academic.oup.com/endo/article/159/12/3910/5133692)]^. 

 
 [Feature plots](https://www.rdocumentation.org/packages/Seurat/versions/3.1.4/topics/FeaturePlot) were used to visually assess gene expression levels of single cells. Cell type was assigned based on visual inspection of canonical markers ^[Ho et al}(https://link.springer.com/article/10.1007/s13238-020-00705-x),^ ^[Fletcher et al](https://www.frontiersin.org/articles/10.3389/fendo.2019.00623/full),^ ^[Chung et al](https://academic.oup.com/endo/article/159/12/3910/5133692)^.


Check to see if any clusters exhibit a lot of genes per cell (mixed droplets) or large number of counts per cell (multiple cells in droplet) and if any clusters are multihormonal
``` {r check the number of genes per cell}
#look at the number of genes per cell
FeaturePlot(Ho.Seuratobj, features = "nFeature_RNA", pt.size = 1) &scale_color_viridis_c()  

#look at the number of counts per cells
FeaturePlot(Ho.Seuratobj, features = "nCount_RNA", pt.size = 1) &scale_color_viridis_c() 

#look at the % mitochondrial mapping
FeaturePlot(Ho.Seuratobj, features = "percent.mt", pt.size = 1) &scale_color_viridis_c() 


#look to see if any multihormonal
FeaturePlot(Ho.Seuratobj, features = c("Lhb", "Pomc", "Gh", "Prl"), pt.size = 2)&scale_color_viridis_c()

```
Cluster5 could appear to be a cluster of cells with large numbers of genes and counts. Is this cluster is doublets/damaged?

Identify the Stem cell
``` {r id stem, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Sox2"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Fstl1"), pt.size = 1)&scale_color_viridis_c()
```
Cluster 8 appears to be the stem cells.


Identify the "multi-hormonals" cells, defined in Ho et al; 
``` {r id multi hormonal, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Pou1f1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Prl"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Gh"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Tshb"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Fshb"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Lhb"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Pomc"), pt.size = 1)&scale_color_viridis_c()
```
Cluster6 appears to be the multihormonal cells.


Identify lactotophs;
``` {r id lacto, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Pou1f1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Prl"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Agtr1b"), pt.size = 1)&scale_color_viridis_c()
``` 
0 & 3 appear to be the lactotrophs

Identify Somatotophs; 
``` {r id somato, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Pou1f1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Gh"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Ghrhr"), pt.size = 1)&scale_color_viridis_c()
```

CLusters 1,4,17 & 2 appear to be the somatotrophs


Identify gonadotophs, 
``` {r id gonado, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Fshb"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Lhb"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Gnrhr"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Cga"), pt.size = 1)&scale_color_viridis_c()
``` 
Cluster 10 appears to be the gonadotrophs.


Identify Melanotrophs;
``` {r id melano, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Pomc"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Pcsk2"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Pax7"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Tbx19"), pt.size = 1)&scale_color_viridis_c()
``` 
Clusters 9, 11 & 12 appear to be the melanotrophs.


Identify Corticotrophs; 
``` {r id cort, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
#Dont want any of this:
FeaturePlot(Ho.Seuratobj, features = c("Pcsk2"), pt.size = 1)&scale_color_viridis_c()
#want these;
FeaturePlot(Ho.Seuratobj, features = c("Pomc"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Crhr1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Tbx19"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Cdh8"), pt.size = 1)&scale_color_viridis_c()


```
Cluster 14 & 19 appears to be the corticotrophs.

Identify thyrotophs ;
``` {r id thyro, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Pou1f1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Tshb"), pt.size = 1)&scale_color_viridis_c()
```
Not clear which cluster represents the thyrotrophs. May not be present in sample. 

connective tissue (collagen cells) in Cheung et al, Folliculostellate cells in Ho et al,  pericytes in fletcher et al
``` {r id connective tissues, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Fstl1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Col1a1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("S100b"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Fxyd1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Gstm2"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Capn6"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Dcn"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Lum"), pt.size = 1)&scale_color_viridis_c()
``` 
Cluster 16 appears to be the connective tissue cells.

white blood cells (C1qa) Macrophages in Ho paper leukocytes in fletcher
``` {r id white blood cells, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("C1qa"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Ctss"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Cd53"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Tyrobp"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Fcer1g"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Laptm5"), pt.size = 1)&scale_color_viridis_c()
```
Cluster 15 appears to be the white blood cells (macrophages).



Identify Erythrocytes/red blood cells; 
``` {r id red blood cellss, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Hbb-bt"), pt.size = 1)&scale_color_viridis_c()

FeaturePlot(Ho.Seuratobj, features = c("Hba-a1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Hba-a2"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Hbb-b1"), pt.size = 1)&scale_color_viridis_c()
```
Cluster 20 appears to represent RBCs. Appear mixed with WBC in small numbers. 


Identify endothilial cells;) 
``` {r id endothelia cells, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Pecam1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Plvap"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Aplnr"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Emcm"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Clec14a"), pt.size = 1)&scale_color_viridis_c()
```
It is unclear which cluster represents endothelial cells. May not be present in sample.Appears to be is a small cluster off stem cell cluster. 



Identify posteriour pituitary cells;
``` {r id posterior cells, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Nkx2-1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Gfap"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("S100b"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Avp"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Oxt"), pt.size = 1)&scale_color_viridis_c()

FeaturePlot(Ho.Seuratobj, features = c("Lhx2"), pt.size = 1)&scale_color_viridis_c()
```
Cluster8 appears to represent posteriour pituitary cells.


Identify Mki67+ from Ho et al; 
``` {r id Mki67+ cells, echo=FALSE,fig.height=3.5, message=FALSE}
DimPlot(Ho.Seuratobj, label=TRUE)+ ggtitle("Pituitary scRNAseq Clusters")
FeaturePlot(Ho.Seuratobj, features = c("Pou1f1"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Prl"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Ghrhr"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Top2a"), pt.size = 1)&scale_color_viridis_c()
FeaturePlot(Ho.Seuratobj, features = c("Mki67"), pt.size = 1)&scale_color_viridis_c()
``` 
Cluster 21 appears to represent the Mki67+ cells. THey may be mixed in with the lactotrophs.


These plots would suggest the following attribution of cell type:

 * Thyrotrophs;                  Cluster  -- 
 * Somatotrophs;                 Cluster  1,4,5,6,7,20,29,30,34    
 * Lactotrophs;                  Cluster  0,2,3,10,31 
 * Gonadotrophs;                 Cluster  16,28  
 * Melanotrophs;                 Cluster  8,11,12  
 * Corticotrophs;                Cluster  24,25  
 * Stem cells;                   Cluster  15,19    
 * Endothelial cells;            Cluster  --   
 * Posteriour pituitary cells;   Cluster  23    
 * Collagen cells;               Cluster  21   
 * Red blood cells;              Cluster  33    
 * White blood cells;            Cluster  22,36   
 * Mki67+                        Cluster  37 
 * Multi Hormonal                Cluster  9,26,27    
 * Uncategorised                 Cluster  17,32,35
 * doublets/damaged              Cluster  13,14
 
Create a new seurat object for the named clusters
``` {r dummy objects for names}
named.Ho <- Ho.Seuratobj
namedbysex <- Ho.Seuratobj
```

 
attribute cell types to the clusters
``` {r name clusters, echo=FALSE}
new.cluster.ids <- c( "Lactotroph","Somatotroph","Lactotroph","Lactotroph","Somatotroph","Somatotroph","Somatotroph","Somatotroph","Melanotroph","Multi Hormonal", "Lactotroph","Melanotroph","Melanotroph","doublets/damaged","doublets/damaged","Stem Cells","Gonadotroph","Uncategorised","Multi Hormonal","Stem Cells","Somatotroph","Collagen","WBC","posteriour pituitary","Corticotroph","Corticotroph","Gonadotrophs","Corticotrophs","Gonadotroph","Somatotroph","Somatotroph","Lactotroph","Uncategorised","RBC","Somatotroph","Uncategorised","WBC","Mki67+")

names(new.cluster.ids) <- levels(named.Ho)
```

rename clusters with new names
``` {r re-plot clusters with names,fig.height=3.5, echo=FALSE}
#Rename the cluster
named.Ho <- RenameIdents(named.Ho, new.cluster.ids)
#then put on the plot to confirm selected the correct one (sanity check)
```

Visualise the clusters by cell type
``` {r plot clusters with names}
DimPlot(named.Ho,group.by="orig.ident", label=TRUE) + NoLegend()+ ggtitle("Cluster sex")

DimPlot(named.Ho, reduction ="umap", label = TRUE, pt.size = 0.5) +NoLegend()+ ggtitle("Cluster cell types")

#include original cluster labels
DimPlot(Ho.Seuratobj, label=TRUE) + NoLegend()+ ggtitle("scRNAseq clustered")
```
Can see there is a difference in how cell types cluster in secretory cell types; somatotrophs, lactotrophs, gonadotrophs, melanotrophs and corticotrophs. This difference is especially pronounced in the lactotrophs and gonadotrophs, which is consistent with the Ho et al paper. In somatotrophs the male and females share two subclusters (30 & 34) with the others being divergent.In lactortrophs the male and females share cluster 31 with the others being divergent. Melanotrophs also have one shared subcluster (8) and two distinct clusters (11 & 12). Gonadotrophs and corticotrophs do not demonstrate a shared subcluster. The non-secreting cell types appear to cluster in a similar manner with the male and female clustering overlapped in the UMAP. The unidentified cluster 32 appears only in the femal data. Differential analysis should shed some light on what this cluster might be. 


Visualise the cell types sub-clustered by sex;

Subcluster secretory cell types by sex
``` {r name clusters, subcluster by sex, echo=FALSE}
new.cluster.ids.bysex <- c( "Male Lactotroph","Male Somatotroph","Female Lactotroph","Female Lactotroph","Male Somatotroph","Female Somatotroph","Female Somatotroph","Male Somatotroph","Shared Melanotroph","Multi Hormonal", "Female Lactotroph","Male Melanotroph","Female Melanotroph","doublets/damaged","doublets/damaged","Stem Cells","Male Gonadotroph","Uncategorised","Multi Hormonal","Stem Cells","Male Somatotroph","Collagen","WBC","posteriour pituitary","Female Corticotroph","Male Corticotroph","Multi Hormonal","Multi Hormonal","Female Gonadotroph","Shared Somatotroph","Shared Somatotroph","Shared Lactotroph","Uncategorised","RBC","Shared Somatotroph","Uncategorised","WBC","Mki67+")

names(new.cluster.ids.bysex) <- levels(namedbysex)
```

rename clusters with new names
``` {r re-plot clusters with names by sex,fig.height=3.5, echo=FALSE}
#Rename the cluster
namedbysex <- RenameIdents(namedbysex, new.cluster.ids.bysex)
#then put on the plot to confirm slected the correct one (sanity check)
```

Visualise the clusters by cell type, subclustered by sex
``` {r plot clusters with names}
DimPlot(namedbysex,group.by="orig.ident", label=TRUE) + NoLegend()+ ggtitle("Cluster sex")

#include original cluster labels
DimPlot(Ho.Seuratobj, label=TRUE) + NoLegend()+ ggtitle("scRNAseq clustered")

DimPlot(namedbysex, reduction ="umap", label = FALSE, pt.size = 0.5) + ggtitle("Cluster cell types, subclustered by sex")
```


\newpage
## Examining differential expression between clusters

``` {r DE clusters, include=FALSE}
clusters.DE <- subset(named.Ho, idents = c("Somatotroph", "Lactotroph","Gonadotroph","Melanotroph","Gonadotroph","Corticotroph"))
                     
```

```{r run DE} 

#find the markers for EVERY CLUSTER when compared to remaining cells, only +ve ones, 2 fold enrichment
markers <-FindAllMarkers(clusters.DE, only.pos = TRUE, min.pct = 0.25, logfc.threshold =0.25)
#examine top 2 deferentially expressed genes in each corticotroph cluster
DE <- markers %>% group_by(cluster) %>% top_n(n=10, wt= avg_logFC)

```
``` {r DE summary, echo=FALSE,message=FALSE}
head(DE, n=50)

```

















Examine the differences in the shared secretory clusters (only somatotroph, lactotroph and melanotroph demonstrate shared clusters)
``` {r just shared, include=FALSE}
shared.clusters <- subset(namedbysex, idents = c("Shared Melanotroph","Shared Somatotroph","Shared Lactotroph"))
                     
```

```{r shared cluster DE} 

#find the markers for EVERY CLUSTER when compared to remaining cells, only +ve ones, 2 fold enrichment
markers <-FindAllMarkers(shared.clusters, only.pos = TRUE, min.pct = 0.25, logfc.threshold =1)
#examine top 2 deferentially expressed genes in each corticotroph cluster
mDE <- markers %>% group_by(cluster) %>% top_n(n=2, wt= avg_logFC)

```

``` {r shared DE summary, echo=FALSE,message=FALSE}
head(mDE, n=6)

```
These deferentially expressed genes make sense for the shared clusters and give confidence to the cell attribution for these cell types.

``` {r just male cort and gonad, include=FALSE}
cort.gonad <- subset(named.Ho, idents = c("Somatotroph", "LactotrophGonadotroph","Melanotroph","Gonadotroph","Corticotroph"))
                     
```

```{r male cort and gonad cluster DE} 

#find the markers for EVERY CLUSTER when compared to remaining cells, only +ve ones, 2 fold enrichment
markers <-FindAllMarkers(cort.gonad, only.pos = TRUE, min.pct = 0.25, logfc.threshold =0.7)
#examine top 2 deferentially expressed genes in each corticotroph cluster
DE <- markers %>% group_by(cluster) %>% top_n(n=2, wt= avg_logFC)

```
``` {r male cort and gonad  DE summary, echo=FALSE,message=FALSE}
head(DE, n=4)

```




























To build confidence in the gonadotroph and corticotroph attribution, need to examine these clusters separately. THis must be done for males and individuals deparately so that the differences between sexes is not entangled with the difference between the cell types.

``` {r just male cort and gonad, include=FALSE}
male.cort.gonad <- subset(namedbysex, idents = c("Male Gonadotroph","Male Corticotroph"))
                     
```

```{r male cort and gonad cluster DE} 

#find the markers for EVERY CLUSTER when compared to remaining cells, only +ve ones, 2 fold enrichment
markers <-FindAllMarkers(male.cort.gonad, only.pos = TRUE, min.pct = 0.25, logfc.threshold =1)
#examine top 2 deferentially expressed genes in each corticotroph cluster
mDE <- markers %>% group_by(cluster) %>% top_n(n=2, wt= avg_logFC)

```
``` {r male cort and gonad  DE summary, echo=FALSE,message=FALSE}
head(mDE, n=4)

```

It would appear the male corticotrophs do not demonstarate 2 fold enrichment. Try lower.


```{r male cort and gonad cluster lower foldchange DE} 

#find the markers for EVERY CLUSTER when compared to remaining cells, only +ve ones
markers <-FindAllMarkers(male.cort.gonad, only.pos = TRUE, min.pct = 0.25, logfc.threshold =0.7)
#examine top 2 deferentially expressed genes in each corticotroph cluster
mDE <- markers %>% group_by(cluster) %>% top_n(n=2, wt= avg_logFC)
```


``` {r male cort and gonad  DE summary lower foldchange, echo=FALSE,message=FALSE}
head(mDE, n=4)

```

See corticotrophs at a 1.6 times enrichment. Nnat is an unexpected top gene.

Repeat for females;
``` {r just female cort and gonad, include=FALSE}
female.cort.gonad <- subset(namedbysex, idents = c("Female Gonadotroph","Female Corticotroph"))
                     
```

```{r female cort and gonad cluster DE} 

#find the markers for EVERY CLUSTER when compared to remaining cells, only +ve ones 
markers <-FindAllMarkers(female.cort.gonad, only.pos = TRUE, min.pct = 0.25, logfc.threshold =0.7)
#examine top 2 deferentially expressed genes in each corticotroph cluster
fDE <- markers %>% group_by(cluster) %>% top_n(n=2, wt= avg_logFC)

```

``` {r female cort and gonad  DE summary, echo=FALSE,message=FALSE}
head(fDE, n=4)

```
Again see corticotrophs at 1.6 times enrichemnt and Nnat.Hba-a1 is to do with hemoglobin.Unexpected.



The real question is what genes are differentially expressed between male and female corticotrophs?

``` {r corts bot sexes , include=FALSE}
cort.only <- subset(namedbysex, idents = c("Male Corticotroph","Female Corticotroph"))
                     
```

```{r female cort and gonad cluster DE} 

#find the markers for EVERY CLUSTER when compared to remaining cells, only +ve ones, 1.6 fold enrichment
markers <-FindAllMarkers(cort.only, only.pos = TRUE, min.pct = 0.25, logfc.threshold =0.7)
#examine top 2 deferentially expressed genes in each corticotroph cluster
mDE <- markers %>% group_by(cluster) %>% top_n(n=2, wt= avg_logFC)

```

``` {r female cort and gonad  DE summary, echo=FALSE,message=FALSE}
head(mDE, n=4)

```



\newpage 
## Examine cluster proportions

## Analyse male cell proportions

First pull in only the male secretory cell types


Find how many cells per cluster
``` {r cells per cluster}
#Use the Idents function
cellscluster <- table(Idents(Ho.Seuratobj))
```

Find how many cells per cluster (males)
``` {r mcells per cluster}
#Use the Idents function
mcellscluster <- table(Idents(maleclusters))
```

How many cells total and per cluster?
``` {r mtotal cells}
#Use the sum function
mcellstotal <- sum(mcellscluster)
# the L in values denotes that this is an integer

#make cells per cluster a datafram  
mcellspercluster <- data.frame(mcellscluster)
```

Percentage thyrotrophs
``` {r % mthyro}
#Find the thyrotroph index
mthyroidx <- which(mcellspercluster=="Thyrotroph")

#pull out the number of thyrotrophs
mthyros <- mcellspercluster[mthyroidx,"Freq"]

mpropthy <- (mthyros/mcellstotal)*100
```

Percentage somatotrophs
``` {r % msomatotrophs}
#Find the somatotroph index
msomatoidx <- which(mcellspercluster=="Somatotroph")

#pull out the number of thyrotrophs
msomatos <- mcellspercluster[msomatoidx,"Freq"]

mpropsom <- (msomatos/mcellstotal)*100
```

Percentage lactotrophs
``` {r % mlactotrophs}
#Find the lactotroph index
mlactoidx <- which(mcellspercluster=="Lactotroph")

#pull out the number of thyrotrophs
mlactos <- mcellspercluster[mlactoidx,"Freq"]

mproplac <- (mlactos/mcellstotal)*100
```

Percentage Gonadotrophs
``` {r % mgonadotrophs}
#Find the gonadotroph index
mgonadoidx <- which(mcellspercluster=="Gonadotroph")

#pull out the number of thyrotrophs
mgonados <- mcellspercluster[mgonadoidx,"Freq"]

mpropgon <- (mgonados/mcellstotal)*100
```

Percentage Melanotrophs
``` {r % mmelanotrophs}
#Find the melanotroph index
mmelanoidx <- which(mcellspercluster=="Melanotroph")

#pull out the number of thyrotrophs
mmelanos <- mcellspercluster[mmelanoidx,"Freq"]

mpropmel <- (mmelanos/mcellstotal)*100
```

Percentage corticotrophs
``` {r % mcorticotrophs}
#Find the corticotroph index
mcortidx <- which(mcellspercluster=="Corticotroph")

#pull out the number of thyrotrophs
mcorts <- mcellspercluster[mcortidx,"Freq"]

mpropcor <- (mcorts/mcellstotal)*100
```

Percentage stem cells
``` {r % mstem cells}
#Find the corticotroph index
mstemidx <- which(mcellspercluster=="Stem Cells")

#pull out the number of thyrotrophs
mstems <- mcellspercluster[mstemidx,"Freq"]

mpropstem <- (mstems/mcellstotal)*100
```

Percentage endothelial cells
``` {r % mendothelial cells}
#Find the corticotroph index
mendoidx <- which(mcellspercluster=="Endothelial cells")

#pull out the number of thyrotrophs
mendos <- mcellspercluster[mendoidx,"Freq"]

mpropendo <- (mendos/mcellstotal)*100
```

Percentage posteriour pituitary cells
``` {r % mposteriour pituitary cells}
#Find the corticotroph index
mpostidx <- which(mcellspercluster=="posteriour pituitary")

#pull out the number of thyrotrophs
mposts <- mcellspercluster[mpostidx,"Freq"]

mproppost <- (mposts/mcellstotal)*100
```

Percentage collagen cells
``` {r % mcollagen cells}
#Find the corticotroph index
mcolidx <- which(mcellspercluster=="Collagen")

#pull out the number of thyrotrophs
mcols <- mcellspercluster[mcolidx,"Freq"]

mpropcol <- (mcols/mcellstotal)*100
```


Percentage red blood cells
``` {r % mred blood cells}
#Find the corticotroph index
mrbcidx <- which(mcellspercluster=="RBC")

#pull out the number of thyrotrophs
mrbcs <- mcellspercluster[mrbcidx,"Freq"]

mproprbc <- (mrbcs/mcellstotal)*100
```

Percentage white blood cells
``` {r % mwhite blood cells}
#Find the corticotroph index
mwbcidx <- which(mcellspercluster=="WBC")

#pull out the number of thyrotrophs
mwbcs <- mcellspercluster[mwbcidx,"Freq"]

mpropwbc <- (mwbcs/mcellstotal)*100
```

Percentage Mki67+
``` {r % mMki67+ blood cells}
#Find the corticotroph index
mMki67idx <- which(mcellspercluster=="Mki67+")

#pull out the number of thyrotrophs
mMki67s <- mcellspercluster[mMki67idx,"Freq"]

mpropMki67 <- (mMki67s/mcellstotal)*100
```
Percentage uncategorised
``` {r % muncategorised cells}
#Find the corticotroph index
mUncategorisedidx <- which(mcellspercluster=="Uncategorised")

#pull out the number of thyrotrophs
mUncategoriseds <- mcellspercluster[mUncategorisedidx,"Freq"]

mpropUncategorised <- (mUncategoriseds/mcellstotal)*100
```
 
Percentage multi hormonal
``` {r % mmulti hormonal cells}
#Find the corticotroph index
mMultiHormonalidx <- which(mcellspercluster=="Multi Hormonal")

#pull out the number of thyrotrophs
mMultiHormonals <- mcellspercluster[mMultiHormonalidx,"Freq"]

mpropMultiHormonal <- (mMultiHormonals/mcellstotal)*100
``` 
 
 Male pituitary cell proportions (multihormonal, uncateghorised and damaged cells excluded)
 * Thyrotrophs;         --                  
 * Somatotrophs;        48%                  
 * Lactotrophs;         21%                     
 * Gonadotrophs;        5%              
 * Melanotrophs;        10%              
 * Corticotrophs;       4%              
 * Stem cells;          6%          
 * Endothelial cells;   --         
 * Posteriour pituitary cells; --   
 * Collagen cells;      2%               
 * Red blood cells;     --           
 * White blood cells;   3%  
 * Mki67+;              <1%   
 
Total ~ 100%




\newpage

## Analyse Female corticotroph cell proportions

Find how many cells per cluster
``` {r fcells per cluster}
#Use the Idents function
fcellscluster <- table(Idents(femaleclusters))
```

How many cells total and per cluster?
``` {r ftotal cells}
#Use the sum function
fcellstotal <- sum(fcellscluster)
# the L in values denotes that this is an integer

#make cells per cluster a datafram  
fcellspercluster <- data.frame(fcellscluster)
```

Percentage thyrotrophs
``` {r % fthyro}
#Find the thyrotroph index
fthyroidx <- which(fcellspercluster=="Thyrotroph")

#pull out the number of thyrotrophs
fthyros <- fcellspercluster[fthyroidx,"Freq"]

fpropthy <- (fthyros/fcellstotal)*100
```

Percentage somatotrophs
``` {r % fsomatotrophs}
#Find the somatotroph index
fsomatoidx <- which(fcellspercluster=="Somatotroph")

#pull out the number of thyrotrophs
fsomatos <- fcellspercluster[fsomatoidx,"Freq"]

fpropsom <- (fsomatos/fcellstotal)*100
```

Percentage lactotrophs
``` {r % flactotrophs}
#Find the lactotroph index
flactoidx <- which(fcellspercluster=="Lactotroph")

#pull out the number of thyrotrophs
flactos <- fcellspercluster[flactoidx,"Freq"]

fproplac <- (flactos/fcellstotal)*100
```

Percentage Gonadotrophs
``` {r % fgonadotrophs}
#Find the gonadotroph index
fgonadoidx <- which(fcellspercluster=="Gonadotroph")

#pull out the number of thyrotrophs
fgonados <- fcellspercluster[fgonadoidx,"Freq"]

fpropgon <- (fgonados/fcellstotal)*100
```

Percentage Melanotrophs
``` {r % fmelanotrophs}
#Find the melanotroph index
fmelanoidx <- which(fcellspercluster=="Melanotroph")

#pull out the number of thyrotrophs
fmelanos <- fcellspercluster[fmelanoidx,"Freq"]

fpropmel <- (fmelanos/fcellstotal)*100
```

Percentage corticotrophs
``` {r % fcorticotrophs}
#Find the corticotroph index
fcortidx <- which(fcellspercluster=="Corticotroph")

#pull out the number of thyrotrophs
fcorts <- fcellspercluster[fcortidx,"Freq"]

fpropcor <- (fcorts/fcellstotal)*100
```

Percentage stem cells
``` {r % fstem cells}
#Find the corticotroph index
fstemidx <- which(fcellspercluster=="Stem Cells")

#pull out the number of thyrotrophs
fstems <- fcellspercluster[fstemidx,"Freq"]

fpropstem <- (fstems/fcellstotal)*100
```

Percentage endothelial cells
``` {r % fendothelial cells}
#Find the corticotroph index
fendoidx <- which(fcellspercluster=="Endothelial cells")

#pull out the number of thyrotrophs
fendos <- fcellspercluster[fendoidx,"Freq"]

fpropendo <- (fendos/fcellstotal)*100
```

Percentage posteriour pituitary cells
``` {r % fposteriour pituitary cells}
#Find the corticotroph index
fpostidx <- which(fcellspercluster=="posteriour pituitary")

#pull out the number of thyrotrophs
fposts <- fcellspercluster[fpostidx,"Freq"]

fproppost <- (fposts/fcellstotal)*100
```

Percentage collagen cells
``` {r % fcollagen cells}
#Find the corticotroph index
fcolidx <- which(fcellspercluster=="Collagen")

#pull out the number of thyrotrophs
fcols <- fcellspercluster[fcolidx,"Freq"]

fpropcol <- (fcols/fcellstotal)*100
```


Percentage red blood cells
``` {r % fred blood cells}
#Find the corticotroph index
frbcidx <- which(fcellspercluster=="RBC")

#pull out the number of thyrotrophs
frbcs <- fcellspercluster[frbcidx,"Freq"]

fproprbc <- (frbcs/fcellstotal)*100
```

Percentage white blood cells
``` {r %fwhite blood cells}
#Find the corticotroph index
fwbcidx <- which(fcellspercluster=="WBC")

#pull outf the number of thyrotrophs
fwbcs <- fcellspercluster[fwbcidx,"Freq"]

fpropwbc <- (fwbcs/fcellstotal)*100
```

Percentage Mki67+
``` {r % fMki67+ blood cells}
#Find the corticotroph index
fMki67idx <- which(fcellspercluster=="Mki67+")

#pull out the number of thyrotrophs
fMki67s <- fcellspercluster[fMki67idx,"Freq"]

fpropMki67 <- (fMki67s/fcellstotal)*100
```
Percentage uncategorised
``` {r % funcategorised cells}
#Find the corticotroph index
fUncategorisedidx <- which(fcellspercluster=="Uncategorised")

#pull out the number of thyrotrophs
fUncategoriseds <- fcellspercluster[fUncategorisedidx,"Freq"]

fpropUncategorised <- (fUncategoriseds/fcellstotal)*100
```
 
Percentage multi hormonal
``` {r % fmulti hormonal cells}
#Find the corticotroph index
fMultiHormonalidx <- which(fcellspercluster=="Multi Hormonal")

#pull out the number of thyrotrophs
fMultiHormonals <- fcellspercluster[fMultiHormonalidx,"Freq"]

fpropMultiHormonal <- (fMultiHormonals/fcellstotal)*100
``` 

 Female pituitary cell proportions (multihormonal, uncateghorised and damaged cells excluded) 
 * Thyrotrophs;         --                   
 * Somatotrophs;        26%   
 * Lactotrophs;         39%           
 * Gonadotrophs;        3%     
 * Melanotrophs;        15%     
 * Corticotrophs;       3%     
 * Stem cells;          7%                   
 * Endothelial cells;   --              
 * Posteriour pituitary cells;  --
 * Collagen cells;      3%          
 * Red blood cells;     --              
 * White blood cells;   4% 
 * Mki67+;              <1%

Total ~100%

The distribution of cells types in Males and Females is different.


\newpage 
## Isolate the corticotrophs

Isolate the corticotrophs and create a new Seurat object:
``` {r isolate corticotroph cluster, include=FALSE}
corts <- subset(Ho.Seuratobj, idents = "Corticotroph")
```


Visualise the corticotroph cluster on its own:

``` {r plot corts group sex}
DimPlot(corts,group.by="Sex", label=TRUE) + NoLegend()+ ggtitle("Corticotroph Cluster grouped by sex")

```


```{r Plotcort seperate by sex, echo = FALSE,fig.height=3.5}
DimPlot(corts, split.by = "Sex", label=FALSE) + NoLegend() + ggtitle("Corticotrophs split By sex")
```

Can see that the male and female corticotrophs cluster differently. Are different genes being expressed?

Need to break corts up into male and female





























d
